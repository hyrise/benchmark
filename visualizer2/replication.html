<!DOCTYPE HTML><html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>Highcharts Example</title>

</head>

<body>
    <img src="http://hpi.de/fileadmin/templates/img/hpi_logo_srgb_wb_sl1_web80.png" style="float: left" />
    <h1 style="margin-left: 200px; padding-top: 30px; color: rgb(89, 96, 101); font-family: Verdana, sans-serif; margin-bottom: 50px">HYRISE Live Throughput Visualizer</h1>
    <div id="graphs"></div>

    <div style=" overflow: auto; width:1700px; margin: 0 auto ">
        <div id="delayContainer" style="border:1px;width: 700px; height: 300px; float:left; margin: 20px"></div>
        <div id="heatMapContainer" style="width: 400px; height: 200px; float:left; margin: 50px"></div>
        <div style=" width:150px; float:left; margin: 20px auto">
            <button type="button" id="btn-one-replica" data-loading-text="Loading..." class="btn btn-primary" style="margin: 5px auto; margin-top:30px">
              Use 1 Replica
            </button>
            <button type="button" id="btn-two-replica" data-loading-text="Loading..." class="btn btn-primary" style="margin: 5px auto">
              Use 2 Replica
            </button>
            <button type="button" id="btn-three-replica" data-loading-text="Loading..." class="btn btn-primary" style="margin:5px auto">
              Use 3 Replica
            </button>
            <button type="button" id="btn-kill-master" data-loading-text="Loading..." class="btn btn-primary" style="margin: 5px auto">
              Kill Master
            </button>
        </div>
	<div style=" width:150px; float:left; margin: 20px auto">
            <button type="button" id="btn-startup" data-loading-text="Loading..." class="btn btn-primary" style="margin: 5px auto; margin-top:30px">
              Start Instances
            </button>
            <button type="button" id="btn-read-workload" data-loading-text="Loading..." class="btn btn-primary" style="margin: 5px auto">
              Start Read Workload
            </button>
            <button type="button" id="btn-write-workload" data-loading-text="Loading..." class="btn btn-primary" style="margin:5px auto">
              Start Write Workload
            </button>
            <button type="button" id="btn-kill-all" data-loading-text="Loading..." class="btn btn-primary" style="margin: 5px auto">
              Kill All Instances
            </button>
        </div>
    </div>

    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>

    
    
    <!-- // <script type="text/javascript" src="http://code.highcharts.com/stock/highstock.js"></script> -->

    <script src="http://github.highcharts.com/highcharts.js"></script>
    <script src="http://github.highcharts.com/highcharts-more.js"></script>
    <script src="http://github.highcharts.com/modules/heatmap.js"></script>
    <script src="http://github.highcharts.com/modules/exporting.js"></script>

    <!-- // <script type="text/javascript" src="http://code.highcharts.com/highcharts.js"></script> -->
    <!-- // <script src="http://code.highcharts.com/highcharts-more.js"></script> -->
    <!-- // <script src="http://code.highcharts.com/modules/heatmap.js"></script> -->
    <!-- // <script type="text/javascript" src="http://code.highcharts.com/modules/exporting.js"></script>        -->

    
    <!-- // <script src="http://code.highcharts.com/modules/exporting.js"></script> -->

    <!-- // <script type="text/javascript" src="http://github.highcharts.com/highstock.src.js"></script> -->

    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/mootools/1.2.4/mootools-yui-compressed.js"></script>

    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css">

    <!-- Optional theme -->
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap-theme.min.css">

    <!-- Latest compiled and minified JavaScript -->
    <script src="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>

    <script type="text/javascript">
    var SCALE = 10; // 10 points per second - needs to correlate with ab

    $(document).ready(function () {

        $('#heatMapContainer').highcharts({

            chart: {
                type: 'heatmap',
                marginTop: 40,
                marginBottom: 40,
                events: {
                    load: function () {
                        // set up the updating of the chart each second
                        var series = this.series[0], events = this.series[1];
                        var inserted_data = [], inserted_events = [];
                        var chart = this;
                        var last_size = 0;
                        setInterval(function () {
                            new Request({
                                method:"GET",
                                url: "load",
                                onSuccess:function(response){
                                    json = $.parseJSON(response);
                                    if(!json) return
                                    chart.series[0].setData([[0,0,json[0][0]],[1,0,json[0][1]], [2,0,json[0][2]],[3,0,json[0][3]],[4,0,json[0][4]],[5,0,json[0][5]],[6,0,json[0][6]],[7,0,json[0][7]],[0,1,json[1][0]],[1,1,json[1][1]], [2,1,json[1][2]],[3,1,json[1][3]],[4,1,json[1][4]],[5,1,json[1][5]],[6,1,json[1][6]],[7,1,json[1][7]],[0,2,json[2][0]],[1,2,json[2][1]], [2,2,json[2][2]],[3,2,json[2][3]],[4,2,json[2][4]],[5,2,json[2][5]],[6,2,json[2][6]],[7,2,json[2][7]],[0,3,json[3][0]],[1,3,json[3][1]], [2,3,json[3][2]],[3,3,json[3][3]],[4,3,json[3][4]],[5,3,json[3][5]],[6,3,json[3][6]],[7,3,json[3][7]]]);
<!-- [[0, 0, json[0][0]], [0, 1, json[0][1]],[0, 2, json[0][2]], [0, 3, json[0][3]], [0, 4, json[0][4]], [0, 5, json[0][5]], [0, 6, json[0][6]], [0, 7, json[0][7]], [0, 8, json[0][8]], [0, 9, json[0][9]], [1, 0, json[1][0]], [1, 1, json[1][1]], [1, 2, json[1][2]], [1, 3, json[1][3]], [1, 4, json[1][4]], [1, 5, json[1][5]], [1, 6, json[1][6]], [1, 7, json[1][7]], [1, 8, json[1][8]], [1, 9, json[1][9]], [2, 0, json[2][0]], [2, 1, json[2][1]], [2, 2, json[2][2]], [2, 3, json[2][3]], [2, 4, json[2][4]], [2, 5, json[2][5]], [2, 6, json[2][6]], [2, 7, json[2][7]], [2, 8, json[2][8]], [2, 9, json[2][9]], [3, 0, json[3][0]], [3, 1, json[3][1]], [3, 2, json[3][2]], [3, 3, json[3][3]], [3, 4, json[3][4]], [3, 5, json[3][5]], [3, 6, json[3][6]], [3, 7, json[3][7]], [3, 8, json[3][8]], [3, 9, json[3][9]]]); -->
                                }
                            }).send(); //Don't forget to send our request!    
                        }, 1000);
                    }
                }
            },


            title: {
                text: 'Server Load'
            },

            xAxis: {
                categories: ['Core 1', 'Core 2', 'Core 3', 'Core 4', 'Core 5', 'Core 6', 'Core 7', 'Core 8', 'Core 9', 'Core 10']
            },

            yAxis: {
                categories: ['Instance 1', 'Instance 2', 'Instance 3', 'Instance 4'],
                title: null
            },

            colorAxis: {
                min: 0,
                max: 100,
                minColor: '#fffbbc',
                maxColor: '#c4463a',
            },

            legend: {
                align: 'right',
                layout: 'vertical',
                margin: 0,
                verticalAlign: 'top',
                y: 50,
                symbolHeight: 100
            },

            tooltip: {
                formatter: function () {
                    return this.point.value + '% load on <b>' + this.series.yAxis.categories[this.point.y] + '</b> of Node <b>' + this.series.xAxis.categories[this.point.x] + '</b>';
                }
            },

            series: [{
                name: 'Load',
                borderColor: 'silver',
                borderWidth: 0.4,
                data: [[0,0,0],[1,0,0], [2,0,0],[3,0,0],[4,0,0],[5,0,0],[6,0,0],[7,0,0],[0,1,0],[1,1,0], [2,1,0],[3,1,0],[4,1,0],[5,1,0],[6,1,0],[7,1,0],[0,2,0],[1,2,0], [2,2,0],[3,2,0],[4,2,0],[5,2,0],[6,2,0],[7,2,0],[0,3,0],[1,3,0], [2,3,0],[3,3,0],[4,3,0],[5,3,0],[6,3,0],[7,3,0]],

<!-- [[0, 0, 0], [0, 1, 0], [0, 2, 0], [0, 3, 0], [1, 0, 0], [1, 1, 0], [1, 2, 0], [1, 3, 0], [2, 0, 0], [2, 1, 0], [2, 2, 0], [2, 3, 0], [3, 0, 0], [3, 1, 0], [3, 2, 0], [3, 3, 0], [4, 0, 0], [4, 1, 0], [4, 2, 0], [4, 3, 0], [5, 0, 0], [5, 1, 0], [5, 2, 0], [5, 3, 0], [6, 0, 0], [6, 1, 0], [6, 2, 0], [6, 3, 0], [7, 0, 0], [7, 1, 0], [7, 2, 0], [7, 3, 0], [8, 0, 0], [8, 1, 0], [8, 2, 0], [8, 3, 0], [9, 0, 0], [9, 1, 0], [9, 2, 0], [9, 3, 0],], -->
                dataLabels: {
                    enabled: false,
                    color: 'black',
                    style: {
                        textShadow: 'none',
                        HcTextStroke: null
                    }
                }
            }]

    });


        $('#delayContainer').highcharts({

        chart: {
            type: 'gauge',
            plotBorderWidth: 0,
            plotBackgroundColor: {
                linearGradient: { x1: 0, y1: 0, x2: 0, y2: 1 },
                stops: [
                    [0, '#FFFFFF'],
                    [0.3, '#FFFFFF'],
                    [1, '#FFFFFF']
                ]
            },
            plotBackgroundImage: null,
            height: 150
         
        },

        title: {
            text: 'Replication Delay'
        },

        pane: [{
            startAngle: -45,
            endAngle: 45,
            background: null,
            center: ['15%', '145%'],
            size: 220
        }
         , {
             startAngle: -45,
             endAngle: 45,
             background: null,
             center: ['50%', '145%'],
             size: 220
         }, {
             startAngle: -45,
             endAngle: 45,
             background: null,
             center: ['85%', '145%'],
             size: 220
         }
        ],

        yAxis: [{
            min: 0,
            max: 200,
            minorTickPosition: 'outside',
            tickPosition: 'outside',
            labels: {
                rotation: 'auto',
                distance: 20
            },
            plotBands: [{
                from: 180,
                to: 200,
                color: '#C02316',
                innerRadius: '100%',
                outerRadius: '105%'
            }],
            pane: 0,
            title: {
                text: 'Replica A<br/><span style="font-size:8px">#TX Behind</span>',
                y: -40
            }
        }

         , {
             min: 0,
             max: 200,
             minorTickPosition: 'outside',
             tickPosition: 'outside',
             labels: {
                 rotation: 'auto',
                 distance: 20
             },
             plotBands: [{
                 from: 180,
                 to: 200,
                 color: '#C02316',
                 innerRadius: '100%',
                 outerRadius: '105%'
             }],
             pane: 1,
             title: {
                 text: 'Replica B<br/><span style="font-size:8px">#TX Behind</span>',
                 y: -40
             }
         }, {
             min: 0,
             max: 200,
             minorTickPosition: 'outside',
             tickPosition: 'outside',
             labels: {
                 rotation: 'auto',
                 distance: 20
             },
             plotBands: [{
                 from: 180,
                 to: 200,
                 color: '#C02316',
                 innerRadius: '100%',
                 outerRadius: '105%'
             }],
             pane: 2,
             title: {
                 text: 'Replica C<br/><span style="font-size:8px">#TX Behind</span>',
                 y: -40
             }
         }
        ],

        plotOptions: {
            gauge: {
                dataLabels: {
                    enabled: false
                },
                dial: {
                    radius: '100%'
                }
            }
        },


        series: [{
            data: [0],
            yAxis: 0
        }
         , {
             data: [0],
             yAxis: 1
         }, {
             data: [0],
             yAxis: 2
         }
        ]

    },

        // Let the music play
        function (chart) {
            setInterval(function () {
                var r1 = chart.series[0].points[0];
                var r2 = chart.series[1].points[0];
                var r3 = chart.series[2].points[0];
                
                new Request({
                    method:"GET",
                    url:"delay",
                    onSuccess:function(response){
                        json = $.parseJSON(response);
                        rows = json.rows
                        if(!json) return

                        lcid_replica1 = rows[0][2];
                        lcid_replica2 = rows[1][2];
                        lcid_replica3 = rows[2][2];
                        lcid_master = rows[3][2];
                        
                        r = chart.series[0].points[0];
                        r.update(lcid_master-lcid_replica1, false);

                        r = chart.series[1].points[0];
                        r.update(lcid_master-lcid_replica2, false);

                        r = chart.series[2].points[0];
                        r.update(lcid_master-lcid_replica3, false);
    
                        chart.redraw()
                    }
                }).send(); //Don't forget to send our request! 
            }, 1000);
        });



        
        container = $("<div id=main_graph>").attr("style", "min-width: 310px; height: 600px; margin: 50px")
        $("#graphs").append(container)


            container.highcharts({
                chart: {
                    type: 'areaspline',
                    animation: false,
                    // animation: Highcharts.svg, // don't animate in old IE
                    marginRight: 10,
                    events: {
                        load: function () {
                            // set up the updating of the chart each second
                            var series_write = this.series[1];
                            var series_read = this.series[0];

                             //, events = this.series[1];
                            <!-- var inserted_data_write = []; -->
                            <!-- var inserted_data_read = []; -->
                            var chart = this;
                            var last_size_read = 0;
                            var last_size_write = 0;
			    var last_timestamp = 0;
			    var first = true;
			    var last_x_value = 0;
                            setInterval(function () {
	                        new Request({
                                    method: "GET",
                                    url: "QueryData",
                                    onSuccess:function(response) {
                                        json = $.parseJSON(response);
                                        if(!json) return;
                                        var elapsed_time = json.data.timestamp - last_timestamp;
                                        if (!first) last_x_value += elapsed_time;
                                        first = false;
                                        last_timestamp = json.data.timestamp;
                                        <!-- console.log(json.data.timestamp); -->
                                        <!-- console.log(elapsed_time); -->
                                        series_write.addPoint([last_x_value, Math.round((json.data.write-last_size_write)/elapsed_time)]);
                                        last_size_write = json.data.write;
                                        series_read.addPoint([last_x_value, Math.round((json.data.read-last_size_read)/elapsed_time)]);
                                        last_size_read = json.data.read;
                                        chart.redraw();
                                    }
                                }).send()
                                <!-- new Request({ -->
                                <!--             method:"GET", -->
                                <!--             url: "MasterWrites", -->
                                <!--             onSuccess:function(response){ -->
                                <!--                 json = $.parseJSON(response); -->
                                <!--                 if(!json) return -->
                                <!--                 var this_size = Object.keys(json).length -->
                                <!--                 if(this_size < last_size_write) series_read.setData([]) -->
                                <!--                 last_size_write = this_size -->
                                <!--                 $.each(json.data, function(e, i) { -->
                                <!--                     if(inserted_data_write[e]) return; -->
                                <!--                     inserted_data_write[e] = true; -->
                                <!--                     series_write.addPoint([e*SCALE,i-0], false, false, false); -->
                                <!--                 }) -->
                                <!--                 chart.redraw() -->
                                <!--             } -->
                                <!--         }).send(); -->
                                <!-- new Request({ -->
                                <!--     method:"GET", -->
                                <!--     url: "Reads", -->
                                <!--     onSuccess:function(response){ -->
                                <!--         json = $.parseJSON(response); -->
                                <!--         if(!json) return -->
                                <!--         var this_size = Object.keys(json).length -->
                                <!--         if(this_size < last_size_read) series_read.setData([]) -->
                                <!--         last_size_read = this_size -->
                                <!--         $.each(json.data, function(e, i) { -->
                                <!--             if(inserted_data_read[e]) return; -->
                                <!--             inserted_data_read[e] = true; -->
                                <!--             series_read.addPoint([e*SCALE,i-0], false, false, false); -->
                                <!--         }); -->
                                <!--     } -->
                                <!-- }).send(); //Don't forget to send our request!     -->
                            }, 500);
                        }
                    }
                },
                title: {
                    text: "Query Throughput"
                },
                xAxis: {
                    type: 'linear',
                    max: 600,
                    min: 0
                    // ,
                    // labels: {
                        // formatter: function() {return this.value/SCALE + "s"}
                    // }
                },
                yAxis: {
                    title: {
                        text: '#Queries per Second'
                    },
                    // plotLines: [{
                    //     value: 0,
                    //     width: 1,
                    //     color: '#808080'
                    // }],
                    min: 0,
                    max: 6000
                },
                legend: {
                    layout: 'vertical',
                    align: 'right',
                    verticalAlign: 'top',
                    borderWidth: 0
                },
                exporting: {
                    enabled: false
                },
                plotOptions: {
                    areaspline: {
                        marker: {
                            enabled: false
                        }
                    }
                },
                // plotOptions: {
                //     area: {
                //         fillColor: {
                //             linearGradient: { x1: 0, y1: 0, x2: 0, y2: 1},
                //             stops: [
                //                 [0, Highcharts.getOptions().colors[0]],
                //                 [1, Highcharts.Color(Highcharts.getOptions().colors[0]).setOpacity(0).get('rgba')]
                //             ]
                //         },
                //         marker: {
                //             radius: 2
                //         },
                //         lineWidth: 1,
                //         states: {
                //             hover: {
                //                 lineWidth: 1
                //             }
                //         },
                //         threshold: null
                //     }
                // },
                series: [{
                    id: 'read',
                    name: "Read-Only Queries",
                    data: [null],
                    allowPointSelect: false,
                    }, {
                    id: 'write',
                    name: "Write Queries",
                    data: [null],
                    allowPointSelect: false,
                    }
                    // , {
                    //     type : 'flags',
                    //     data : [],
                    //     onSeries : 'data',  // Id of which series it should be placed on. If not defined 
                    //                     // the flag series will be put on the X axis
                    //     shape : 'flag'  // Defines the shape of the flags.
                    // }
                    ],
            });

    });
    </script>

<!-- 
<button type="button" id="loading-example-btn" data-starting-text="Starting Server..." data-started-text="Server Running" data-stopping-text="Stopping Server..." class="btn btn-primary">
  Start Server
</button>
<script>
  $('#loading-example-btn').click(function () {
    var btn = $(this)

    btn.button('starting')
    new Request({
        method:"GET",
        url:"startserver",
        onSuccess:function(response){
            btn.button('reset');
            btn.button('Stop')
        }
    }).send(); //Don't forget to send our request!
  });
</script>

<div width="800px" height="300px">
    <b>Logfile Master:</b>
    <div id="log1"></div>
</div>
<div width="800px" height="300px">
    <b>Logfile Replica1:</b>
    <div id="log2"></div>
</div>
<div width="800px" height="300px">
    <b>Logfile Replica2:</b>
    <div id="log3"></div>
</div>
<div width="800px" height="300px">
    <b>Logfile Replica3:</b>
    <div id="log4"></div>
</div>

<button type="button" id="log-refresh-btn" data-loading-text="loading log..." class="btn btn-primary">Refresh Log</button>

<script>
  $('#log-refresh-btn').click(function () {
    var btn = $(this)
    
    btn.button('loading')
    
    new Request({
        method:"GET",
        url:"log1",
        onSuccess:function(response){
            // btn.button('reset');
            $('#log1').text(response);
        }
    }).send(); //Don't forget to send our request!
    new Request({
        method:"GET",
        url:"log2",
        onSuccess:function(response){
            // btn.button('reset');
            $('#log2').text(response);
        }
    }).send(); //Don't forget to send our request!
    new Request({
        method:"GET",
        url:"log3",
        onSuccess:function(response){
            // btn.button('reset');
            $('#log3').text(response);
        }
    }).send(); //Don't forget to send our request!
    new Request({
        method:"GET",
        url:"log4",
        onSuccess:function(response){
            btn.button('reset');
            $('#log4').text(response);
        }
    }).send(); //Don't forget to send our request!
  });
</script>
 -->


<script>
  $('#btn-one-replica').click(function () {
    var btn = $(this)

    btn.button('loading')
    new Request({
        method:"GET",
        url:"useonereplica",
        onSuccess:function(response){
            btn.button('reset');
        }
    }).send(); //Don't forget to send our request!
  });
</script>

<script>
  $('#btn-two-replica').click(function () {
    var btn = $(this)

    btn.button('loading')
    new Request({
        method:"GET",
        url:"usetworeplica",
        onSuccess:function(response){
            btn.button('reset');
        }
    }).send(); //Don't forget to send our request!
  });
</script>

<script>
  $('#btn-three-replica').click(function () {
    var btn = $(this)

    btn.button('loading')
    new Request({
        method:"GET",
        url:"usethreereplica",
        onSuccess:function(response){
            btn.button('reset');
        }
    }).send(); //Don't forget to send our request!
  });
</script>

<script>
  $('#btn-kill-master').click(function () {
    var btn = $(this), 
        chart = $('#main_graph').highcharts();

console.log(chart.series[0].data.length);
console.log(chart.series[0].data[chart.series[0].data.length-1]);
    chart.xAxis[0].addPlotLine( {
        value: chart.series[0].data[chart.series[0].data.length-1].x,
        color: 'red',
        width: 4});

    btn.button('loading')
    new Request({
        method:"GET",
        url:"killmaster",
        onSuccess:function(response){
            btn.button('reset');
        }
    }).send(); //Don't forget to send our request!
  });
</script>

<script>
  $('#btn-kill-all').click(function () {
    var btn = $(this)

    btn.button('loading')
    new Request({
        method:"GET",
        url:"killall",
        onSuccess:function(response){
            btn.button('reset');
        }
    }).send(); //Don't forget to send our request!
  });
</script>
<script>
  $('#btn-startup').click(function () {
    var btn = $(this)

    btn.button('loading')
    new Request({
        method:"GET",
        url:"startserver",
        onSuccess:function(response){
            btn.button('reset');
        }
    }).send(); //Don't forget to send our request!
  });
</script>
<script>
  $('#btn-read-workload').click(function () {
    var btn = $(this)

    btn.button('loading')
    new Request({
        method:"GET",
        url:"readworkload",
        onSuccess:function(response){
            btn.button('reset');
        }
    }).send(); //Don't forget to send our request!
  });
</script>

<script>
  $('#btn-write-workload').click(function () {
    var btn = $(this)

    btn.button('loading')
    new Request({
        method:"GET",
        url:"writeworkload",
        onSuccess:function(response){
            btn.button('reset');
        }
    }).send(); //Don't forget to send our request!
  });
</script>

</body></html>








