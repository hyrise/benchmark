<!DOCTYPE HTML><html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>Highcharts Example</title>

</head>

<body>
    <img src="http://hpi.de/fileadmin/templates/img/hpi_logo_srgb_wb_sl1_web80.png" style="float: left" />
    <h1 style="margin-left: 200px; padding-top: 30px; color: rgb(89, 96, 101); font-family: Verdana, sans-serif; margin-bottom: 50px">HYRISE Live Throughput Visualizer</h1>
    <div id="graphs"></div>


    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>

    <script type="text/javascript" src="http://code.highcharts.com/stock/highstock.js"></script>

    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/mootools/1.2.4/mootools-yui-compressed.js"></script>

    <script type="text/javascript">
    var SCALE = 10; // 10 points per second - needs to correlate with ab

    $(document).ready(function () {
        $.getJSON('/builds', function(data) {
            $.each(data, function(i, build) {
                container = $("<div>").attr("style", "min-width: 310px; height: 400px; margin: 0 auto")
                $("#graphs").append(container)


                container.highcharts({
                    chart: {
                        type: 'spline',
                        animation: false,
                        // animation: Highcharts.svg, // don't animate in old IE
                        marginRight: 10,
                        events: {
                            load: function () {
                                // set up the updating of the chart each second
                                var series = this.series[0], events = this.series[1];
                                var inserted_data = [], inserted_events = [];
                                var chart = this;
                                var last_size = 0;
                                setInterval(function () {
                                    new Request({
                                        method:"GET",
                                        url: build+".json",
                                        onSuccess:function(response){
                                            json = $.parseJSON(response);
                                            if(!json) return
                                            var this_size = Object.keys(json).length
                                            if(this_size < last_size) series.setData([])
                                            last_size = this_size
                                            $.each(json.data, function(e, i) {
                                                if(inserted_data[e]) return;
                                                inserted_data[e] = true;
                                                series.addPoint([e*SCALE,i-0], false, false, false);
                                            })
                                            $.each(json.events, function(e, i) {
                                                if(inserted_events[e]) return;
                                                inserted_events[e] = true;
                                                title = i
                                                if(title == "kill") title = "◼";
                                                if(title == "restart") title = "▶";
                                                events.addPoint({x: e*SCALE, title: title}, false, false, false);
                                            })
                                            chart.redraw()
                                        }
                                    }).send(); //Don't forget to send our request!    
                                }, 1000);
                            }
                        }
                    },
                    title: {
                        text: build
                    },
                    xAxis: {
                        type: 'linear',
                        max: 600,
                        min: 0,
                        labels: {
                            formatter: function() {return this.value/SCALE + "s"}
                        }
                    },
                    yAxis: {
                        title: {
                            text: '#NewOrder transactions in ' + (1/SCALE) + ' seconds'
                        },
                        plotLines: [{
                            value: 0,
                            width: 1,
                            color: '#808080'
                        }],
                        min: 0,
                        max: 1250
                    },
                    legend: {
                        enabled: false
                    },
                    exporting: {
                        enabled: false
                    },
                    series: [{
                        id: 'data',
                        name: build,
                        data: [],
                        allowPointSelect: false,
                    }, {
                        type : 'flags',
                        data : [],
                        onSeries : 'data',  // Id of which series it should be placed on. If not defined 
                                        // the flag series will be put on the X axis
                        shape : 'flag'  // Defines the shape of the flags.
                    }],
                    plotOptions: {
                        spline: {
                            marker: {
                                enabled: false
                            },
                        }
                    }

                });



            })
        });
    });
    </script>

</body></html>








